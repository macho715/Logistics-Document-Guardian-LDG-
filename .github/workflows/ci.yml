name: CI

on: [push, pull_request]

jobs:
  win-test:
    name: 🧪 Lint • Type • Test (Windows)
    runs-on: windows-latest
    # Removed strategy matrix as it's Windows only now

    steps:
    # 1) Checkout
    - uses: actions/checkout@v4

    # 2) List files (디버그용·선택) - Using cmd shell for dir
    - name: 📂 List files
      run: dir
      shell: cmd

    # 3) Setup Python
    - name: ⬇️ Setup Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'
        cache-dependency-path: |
          pyproject.toml
          requirements.lock

    # 4) Tesseract 설치 (Windows PS1)
    - name: 🛠 Install Tesseract
      run: powershell -ExecutionPolicy Bypass -File scripts/install_tesseract_win.ps1

    # 5) Python deps 설치
    - name: 📦 Install deps
      run: |
        python -m pip install -U pip
        python -m pip install pip-tools
        pip-sync requirements.lock
        python -m pip install -e .        # editable install

    # 6) Ruff Format & Lint
    - name: 🔍 Ruff format check
      run: ruff format --check .
    - name: 🔍 Ruff lint
      run: ruff check .

    # 7) Mypy
    - name: 🔍 Mypy strict typing
      run: mypy .

    # 8) Pytest
    - name: 🧪 Pytest
      run: pytest -q

    # 9) 커버리지 리포트 (선택)
    # - name: Upload coverage
    #   uses: codecov/codecov-action@v4 