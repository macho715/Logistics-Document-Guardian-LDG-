name: CI

on: [push, pull_request]

jobs:
  win-test:
    name: ğŸ§ª Lint â€¢ Type â€¢ Test (Windows)
    runs-on: windows-latest
    # Removed strategy matrix as it's Windows only now

    steps:
    # 1) Checkout
    - uses: actions/checkout@v4

    # 2) List files (ë””ë²„ê·¸ìš©Â·ì„ íƒ) - Using cmd shell for dir
    - name: ğŸ“‚ List files
      run: dir
      shell: cmd

    # 3) Setup Python
    - name: â¬‡ï¸ Setup Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'
        cache-dependency-path: |
          pyproject.toml
          requirements.lock

    # 4) Tesseract ì„¤ì¹˜ (Windows PS1)
    - name: ğŸ›  Install Tesseract
      run: powershell -ExecutionPolicy Bypass -File scripts/install_tesseract_win.ps1

    # 5) Python deps ì„¤ì¹˜
    - name: ğŸ“¦ Install deps
      run: |
        python -m pip install -U pip
        python -m pip install pip-tools
        pip-sync requirements.lock
        python -m pip install -e .        # editable install

    # 6) Ruff Format & Lint
    - name: ğŸ” Ruff format check
      run: ruff format --check .
    - name: ğŸ” Ruff lint
      run: ruff check .

    # 7) Mypy
    - name: ğŸ” Mypy strict typing
      run: mypy .

    # 8) Pytest
    - name: ğŸ§ª Pytest
      run: pytest -q

    # 9) ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ (ì„ íƒ)
    # - name: Upload coverage
    #   uses: codecov/codecov-action@v4 